package com.jiubang.ggheart.apps.desks.diy.frames.screeneditbox.tabs.push.util;

import java.util.HashMap;
import java.util.Locale;
import java.util.Map;

import org.json.JSONException;
import org.json.JSONObject;

import android.content.Context;
import android.os.Build;

import com.gau.go.gostaticsdk.StatisticsManager;
import com.go.proxy.ApplicationProxy;
import com.go.util.AppUtils;
import com.go.util.ConfigurationUtils;
import com.go.util.device.Machine;
import com.jiubang.ggheart.appgame.appcenter.help.RecommAppsUtils;
import com.jiubang.ggheart.apps.gowidget.gostore.util.GoStoreAppInforUtil;
import com.jiubang.ggheart.apps.gowidget.gostore.util.GoStorePhoneStateUtil;
import com.jiubang.ggheart.launcher.LauncherEnv;
import com.jiubang.ggheart.launcher.PackageName;

/**
 * 
 * @author zouguiquan
 *
 */
public class ScreenEditPushHelper {
	
	public static final int REQUEST_GODYNWALLPAPER = 100;
	public static final int REQUEST_GOWALLPAPER = 101;

	public static String sGoDynWallpaperSaveKey = "sGoDynWallpaperSaveKey";	
	public static String sGoDynWallpaperLastRequest = "sGoDynWallpaperLastRequest";		        //最近一次的请求时间

	public static String sGoWallpaperSaveKey = "sGoWallpaperSaveKey";
	public static String sGoWallpaperLastRequest = "sGoWallpaperLastRequest";		        //最近一次的请求时间
		
	public static String sWallpaperNameSaveKey = "sWallpaperNameSaveKey";	
	
	public static final int REQUEST_ID_FOR_WALLPAPER = 602;
	public static final int REQUEST_ID_FOR_WIDGET = 603;
	
	public static int[] sPushKeyArray = new int[]{REQUEST_ID_FOR_WALLPAPER, 
												  REQUEST_ID_FOR_WIDGET};
	
//	public static String sJsonAppId = "appid";
//	public static String sJsonName = "name";
//	public static String sJsonIconDownload = "icon";
//	public static String sJsonIconRes = "iconRes";
//	public static String sJsonDownloadUrl = "downloadurl";
//	public static String sJsonSize = "size";
//	public static String sJsonUpdateTime = "updatetimedesc";
//	public static String sJsonPackage = "packname";
//	public static String sJsonInstalled = "installed";
//	public static String sJsonPreview = "preview";
//	
//	public static String sWPResponseKeyOld = "apps";
	public static String sWPResponseKey = "responseDatas";
	
	public static String sJsonOrderId = "num";
	public static String sJsonPackage = "packagename";
	public static String sJsonDownloadUrl = "downurl";
	public static String sJsonDownloadJpurl = "jpurl";
	public static String sJsonDownloadType = "downtype";
	public static String sJsonPreviewUrl = "previewimgurl";
	public static String sJsonDownloadFlag = "downflag";
	public static String sJsonType = "pkgtype";
	public static String sJsonUpdateTime = "updatetime";
	public static String sJsonTitleName = "channel";
	
	public static final String sPUSHURL = "http://183.61.112.38:8011/recommendedapp/common.do?";
	public static final String sINTERNALURL = "http://goappcenter.3g.net.cn/recommendedapp/common.do?";
	public static final String sEXTERNALURL = "http://goappcenter.goforandroid.com/recommendedapp/common.do?";
	
	public static String sWALLPAPERTESTURL = "http://guiwallpaper.goforandroid.com/guiWallpaper/common?";
	
	static {
		if (ConfigurationUtils.isUseTestServer(LauncherEnv.Server.WALLPAPER_CONFIG_USE_TEST_SERVER)) {
			sWALLPAPERTESTURL = "http://gotest.3g.net.cn/guiWallpaper/common?";
//			http://launcherportal.3g.net.cn:9906/guiWallpaper/common?funid=1
//			sWALLPAPERTESTURL = "http://192.168.1.215:9906/guiWallpaper/common?";
		}
	}
		
	/**
	 * <br>
	 * 功能简述:获取URL地址 <br>
	 * 功能详细描述:funid=x&rd=1234;其中rd是随机数，防止网关cache. <br>
	 * 注意:1:服务器请求，2：统计
	 * 
	 * @return
	 */
	public static String getWallpaperUrl(int funid) {
//		StringBuffer buffer = null;
//		String local = Machine.getCountry(ApplicationProxy.getContext());
//		if (local.equals("cn")) {
//			buffer = new StringBuffer(sInternalUrl);
//		} else {
//			buffer = new StringBuffer(sExternalUrl);
//		}
//		Random random = new Random(new Date().getTime()); // 随机数
//		buffer.append("funid=" + funid + "&rd=" + random.nextLong());
//		random = null;
//		return buffer.toString();
		
		StringBuffer buffer = null;
		buffer = new StringBuffer(sWALLPAPERTESTURL);
		buffer.append("funid=" + funid + "&rd=" + System.currentTimeMillis());
		return buffer.toString();
	}
	
	/**
	 * 
	 * @return
	 */
	public static JSONObject getDynWallpaperPostJson() {
		
		Map<String, Object> extraData = new HashMap<String, Object>();
		extraData.put("pversion", "4.3");
		extraData.put("cversion", "3.19"); 	
		extraData.put("clientid", 21);
		JSONObject headJson = getHeadJson(extraData);
		
		JSONObject postObject = new JSONObject();
		try {
			postObject.put("phead", headJson);
			postObject.put("typeid", 602);
			postObject.put("pageid", 0);
			postObject.put("itp", 2);
			postObject.put("must", 1);
		} catch (JSONException e) {
			e.printStackTrace();
		}
		
		return postObject;
	}
	
	/**
	 * 
	 * @return
	 */
	public static HashMap<String, String> getWallpaperPostParam(int type) {
		
		Map<String, Object> extraData = new HashMap<String, Object>();
		extraData.put("resolution", "320*480");
		JSONObject headJson = getHeadJson(extraData);
		
		JSONObject dataObject = new JSONObject();
		try {
			dataObject.put("phead", headJson);
			dataObject.put("type", type);
			dataObject.put("lst", System.currentTimeMillis());
		} catch (JSONException e) {
			e.printStackTrace();
		}
		
		HashMap<String, String> postParam = new HashMap<String, String>();
		postParam.put("data", dataObject.toString());
		postParam.put("handle", "0");
		postParam.put("shandle", "1");
		return postParam;
	}

	public static JSONObject getHeadJson(Map<String, Object> extraData) {
		Context context = ApplicationProxy.getContext();
		JSONObject pheadJson = new JSONObject();

		try {
			pheadJson.put("pversion", 1); //协议版本
			
			pheadJson.put("aid", Machine.getAndroidId()); //androidid
			
			String imei = GoStorePhoneStateUtil.getVirtualIMEI(context);
			pheadJson.put("imei", imei); //桌面id
			
			pheadJson.put("launcherid", imei); 
			
			pheadJson.put("cid", "1");
			
			pheadJson.put("cversion", RecommAppsUtils.getGoLocherVersion(context)); //桌面的版本号, String例如：3.16
			
			pheadJson.put("cverstr", RecommAppsUtils.buildVersion(context));
			
			pheadJson.put("channel", GoStorePhoneStateUtil.getUid(context)); // 渠道号

			pheadJson.put("local", Machine.getCountry(context).toLowerCase(Locale.getDefault())); //先取sim卡.没有然后再去本地

			pheadJson.put("lang", RecommAppsUtils.language(context).split("_")[0]); //所在国家的语言
			
			pheadJson.put("sdk", Build.VERSION.SDK_INT); //sdklevel

			pheadJson.put("imsi", RecommAppsUtils.getCnUser(context));

			int hasMarket = GoStoreAppInforUtil.isExistGoogleMarket(context) ? 1 : 0;
			pheadJson.put("hasmarket", hasMarket); //判断是否有google市场

			pheadJson.put("sys", Build.VERSION.RELEASE);
			
			pheadJson.put("model", Build.MODEL);

			pheadJson.put("dpi", RecommAppsUtils.getDisplay(context));

			pheadJson.put("net", RecommAppsUtils.buildNetworkState(context)); 

			pheadJson.put("goid", StatisticsManager.getGOID(context));
			
			pheadJson.put("vcode", AppUtils.getVersionCodeByPkgName(ApplicationProxy.getContext(), PackageName.PACKAGE_NAME));
			
			pheadJson.put("ts", System.currentTimeMillis());
			
			if (extraData != null) {
				for (Map.Entry<String, Object> entry : extraData.entrySet()) {
					pheadJson.put(entry.getKey(), entry.getValue());
				}
			}

		} catch (JSONException e) {
			e.printStackTrace();
		}
		return pheadJson;
	}
}
